# Hướng dẫn Self-host Open WebUI trên VPS Ubuntu

Tài liệu này hướng dẫn cách cài đặt Open WebUI sử dụng **OpenRouter** (không chạy Ollama local) trên VPS Ubuntu đã có sẵn Docker, Nginx và Certbot.

## 1. Chạy Open WebUI bằng Docker

Vì bạn chỉ dùng OpenRouter, chúng ta sẽ sử dụng image chính thức của Open WebUI nhưng tắt tính năng Ollama và cấu hình API OpenRouter ngay từ lệnh chạy.

### Lệnh chạy Docker:
Thay `sk-or-v1-xxxxxx` bằng API Key OpenRouter của bạn.

```bash
docker run -d -p 8080:8080 \
  -e OPENAI_API_BASE_URL=https://openrouter.ai/api/v1 \
  -e OPENAI_API_KEY=sk-or-v1-xxxxxx \
  -e ENABLE_OLLAMA=False \
  -v open-webui:/app/backend/data \
  --name open-webui \
  --restart always \
  ghcr.io/open-webui/open-webui:main
```

> [!NOTE]
> - `ENABLE_OLLAMA=False`: Tắt hoàn toàn việc kết nối tới Ollama local.
> - `-p 8080:8080`: Để port 8080 để Nginx proxy vào.

---

## 2. Cấu hình Nginx Reverse Proxy

Tạo file cấu hình Nginx cho domain `chat.tdconuslting.vn`.

### Bước 1: Tạo file cấu hình
```bash
sudo nano /etc/nginx/sites-available/chat.tdconuslting.vn
```

### Bước 2: Dán nội dung sau:
```nginx
server {
    listen 80;
    server_name chat.tdconuslting.vn;

    location / {
        proxy_pass http://127.0.0.1:8080;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;

        # Hỗ trợ WebSockets (quan trọng cho Open WebUI)
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection "upgrade";
        
        # Tăng timeout cho các model phản hồi chậm
        proxy_read_timeout 300;
        proxy_connect_timeout 300;
        proxy_send_timeout 300;
    }
}
```

### Bước 3: Kích hoạt cấu hình và kiểm tra
```bash
sudo ln -s /etc/nginx/sites-available/chat.tdconuslting.vn /etc/nginx/sites-enabled/
sudo nginx -t
sudo systemctl restart nginx
```

---

## 3. Cài đặt SSL bằng Certbot

Sau khi cấu hình Nginx xong, hãy chạy Certbot để lấy chứng chỉ SSL tự động.

```bash
sudo certbot --nginx -d chat.tdconuslting.vn
```

Certbot sẽ tự động sửa file cấu hình Nginx của bạn để ép buộc sử dụng HTTPS.

---

## 4. Kiểm tra và Hoàn tất

1. Truy cập: `https://chat.tdconuslting.vn`
2. Tạo tài khoản admin đầu tiên.
3. Khi vào giao diện chat, bạn sẽ thấy danh sách các model từ OpenRouter đã được tự động hiển thị (vì chúng ta đã cấu hình API Key ở bước 1).

**Lưu ý:** Nếu sau này bạn muốn đổi API Key mà không muốn xóa container, bạn có thể vào trực tiếp giao diện WebUI: `Settings > Connections > OpenAI API` để sửa.
