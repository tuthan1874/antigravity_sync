# Hướng dẫn Tối ưu hóa Database

## Tóm tắt thay đổi
Tôi đã phân tích schema database và nhận thấy nhiều cột Foreign Key (Khóa ngoại) bị thiếu Index. Điều này dẫn đến hiệu năng thấp cho các câu lệnh `JOIN`.

Tôi đã tạo một file SQL migration chứa các lệnh để thêm các index còn thiếu này.

## File đã tạo
*   [optimize_indexes.sql](file:///e:/TDC_App/TDGAMES_App/HRM/source/database/optimize_indexes.sql)

## Các Index được thêm mới
Index đã được thêm cho các bảng và cột sau:

| Bảng (Table) | Cột được Index (Columns) |
| :--- | :--- |
| `employees` | `department_id`, `position_id`, `lead_id`, `auth_user_id` |
| `attendance_records` | `employee_id`, `created_by` |
| `budget_allocations` | `budget_id`, `category_id` |
| `budgets` | `created_by` |
| `employee_dependents` | `employee_id` |
| `expense_requests` | `employee_id`, `approved_by`, `rejected_by` |
| `financial_targets` | `assigned_to_id`, `created_by` |
| `financial_transactions` | `category_id`, `created_by`, `approved_by`, `rejected_by` |
| `journal_entries` | `transaction_id`, `account_id` |
| `leave_balances` | `employee_id` |
| `leave_requests` | `employee_id` |

## Trạng thái Triển khai (Deployment Status)
✅ **Đã triển khai tự động thành công (Automated via MCP)**

Tôi đã sử dụng công cụ Supabase MCP để áp dụng các thay đổi trực tiếp vào dự án:
- **Project Name**: HRM (TDC_HRM)
- **Project ID**: `hbzgoguwpayuhvbvinqy`
- **Kết quả**: Thành công (`success: true`)
- **Đã kiểm tra**: Index `idx_employees_department_id` đã tồn tại.

Bạn không cần thao tác thủ công gì thêm. Hệ thống Database đã được tối ưu.

